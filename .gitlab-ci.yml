---
variables:
  GITLAB_CI_IMAGE_ANSIBLE: 'librespace/ansible:2.9.4'
  GITLAB_CI_IMAGE_PYTHON: 'python'
  GITLAB_CI_PYPI_YAMLLINT: 'yamllint~=1.20.0'
stages:
  - static
  - build
static_yaml:
  stage: static
  image: ${GITLAB_CI_IMAGE_PYTHON}
  before_script:
    - pip install "$GITLAB_CI_PYPI_YAMLLINT"
  script:
    - cd ansible
    - 'yamllint -s .'
static_ansible:
  stage: static
  image: ${GITLAB_CI_IMAGE_ANSIBLE}
  script:
    - cd ansible
    - ansible-playbook --syntax-check -vvv site.yml
    - ansible-lint site.yml
docs:
  image: fedora
  stage: build
  script:
    - dnf -y update
    - dnf -y install texlive-collection-latex texlive-collection-latexrecommended texlive-lipsum texlive-glossaries texlive-circuitikz
    - dnf -y install make cmake
    - cd doc
    - mkdir build
    - cd build
    - cmake ..
    - make pdf
  artifacts:
    paths:
      - doc/build/*.pdf
