%% SDR Testbed System Requirements Specification
%% Copyright (C) 2019 Libre Space Foundation
%%
%% This work is licensed under a
%% Creative Commons Attribution-ShareAlike 4.0 International License.
%%
%% You should have received a copy of the license along with this
%% work.  If not, see <http://creativecommons.org/licenses/by-sa/4.0/>.

\documentclass[english,titlepage,a4paper]{report}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}
\usepackage{color}
\usepackage{float}
\usepackage[hidelinks]{hyperref}
\usepackage{tikz}
\usetikzlibrary{arrows,positioning,fit}
\usepackage[toc,acronyms,section]{glossaries}

\newglossarystyle{definitions}{
  \glossarystyle{long}
  \renewenvironment{theglossary}{
    \begin{longtable}{
        p{3cm}
        p{\glsdescwidth}
      }
  }{
    \end{longtable}
  }
}
\newglossary*{definitions}{Definitions}

\newglossarystyle{references}{
  \glossarystyle{long}
  \renewenvironment{theglossary}{
    \begin{longtable}{
        p{3cm}
        p{\glsdescwidth}
      }
  }{
    \end{longtable}
  }
}
\newglossary*{references}{References}
\makeglossaries

\newglossaryentry{SDR Testbed}{
  type=definitions,
  name=SDR Testbed,
  description={Software Defined Radio Testbed; the system specified in this document}
}
\newglossaryentry{testbed experiment}{
  type=definitions,
  name=testbed experiment,
  description={The procedure as a whole of validating SDR application and technologies}
}
\newglossaryentry{job}{
  type=definitions,
  name=job,
  description={A set of actions queue to be executed on an automation server}
}
\newglossaryentry{scenario}{
  type=definitions,
  name=scenario,
  description={A set of ordered test cases for validating an SDR application}
}
\newglossaryentry{SDR development platform}{
  type=definitions,
  name=SDR development platform,
  description={A development platform which provides toolkits for implementing software defined radios}
}
\newglossaryentry{SDR application}{
  type=definitions,
  name=SDR application,
  description={An application implemented using an SDR development platform}
}

\newglossaryentry{Robot Framework}{
  type=references,
  name=\href{https://robotframework.org/}{Robot Framework},
  description={A Python-based automation framework}
}
\newglossaryentry{VISA}{
  type=references,
  name=\href{https://en.wikipedia.org/wiki/Virtual\_instrument\_software\_architecture}{VISA},
  description={Virtual Instrument Software Architecture}
}
\newglossaryentry{HDF5}{
  type=references,
  name=\href{https://www.hdfgroup.org/solutions/hdf5/}{HDF5},
  description={Hierarchical Data Format, version 5}
}
\newglossaryentry{RFC2119}{
  type=references,
  name=\href{https://www.ietf.org/rfc/rfc2119.txt}{RFC2119},
  description={Key words for use in RFCs to Indicate Requirement Levels}
}

\newacronym{SDR}{SDR}{Software Defined Radio}
\newacronym{CPU}{CPU}{Central Processing Unit}
\newacronym{RAM}{RAM}{Random Access Memory}
\newacronym{USB}{USB}{Universal Serial Bus}
\newacronym{TX}{TX}{Radio transmission}
\newacronym{RX}{RX}{Radio reception}

\newglossaryentry{Ethernet}{
  name=Ethernet,
  description={A computer networking technology}
}

\newcommand{\requirement}[5]{
  \subsection{#2}
  #5

  \noindent
  \begin{tabular}{|l|p{9cm}|}
    \hline
    \textbf{ID} & #1 \\
    \hline
    \textbf{Name} & #2 \\
    \hline
    \textbf{Description} & #3 \\
    \hline
    \textbf{Rationale} & #4 \\
    \hline
  \end{tabular}
}

\title{
  System Requirements Specification \\
  \large Software Defined Radio Testbed
}
\author{Vasilis Tsiligiannis} 
\date{\today\\\textit{DRAFT}}

\begin{document}
\renewcommand*{\arraystretch}{2}
\maketitle
\tableofcontents


\chapter{Introduction}
\section{Purpose}

The purpose of this document is to identify and create a complete set of Software and Hardware Requirements Specifications for implementing a Software Defined Radio Testbed.
The analysis shall contain an architectural overview and high level design and requirements specification which will be the basis to bootstrap the development and integration process.
Such an analysis is necessary in order to provide implementers a clear view and understanding of the system under development as well as defining standard interfaces for users of the system.

\section{Conventions}

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC2119.
However, for readability, these words do not appear in all upper case letters in this specification.

\printglossary[type=definitions,numberedsection,style=definitions,nonumberlist]

\section{Intended Audience}

The intended audience of this document are hardware and software developers who will implement the SDR Testbed described.
It is assumed that the reader is familiar with Software Defined Radio systems and has knowledge of software engineering as well as IT systems in general.

\section{Scope}

The Software Defined Radio Testbed system described in this document plans to become an essential tool for the research and development of SDR-based satellite communication systems.
This testbed will allow early experimentation and testing of new algorithms and configurations.
The implementation of an SDR Testbed system will span from software and hardware development to integration of various SDR toolchains and hardware components.

\printglossary[type=references,numberedsection,style=references,nonumberlist]

\chapter{Description}
\section{System Functions}

This specification is based on high-level requirements which have been collected from various stakeholders.
The collection has been facilitated by the use of a requirements survey.
Based on the survey results and the resources allocated for the project, it is decided that the following high-level functions shall be supported:
\begin{itemize}
\item importing and exporting of data for input and output of experiments
\item selection of various SDR device combinations
\item single TX and RX paths
\item selection of different attenuation levels between TX and RX devices
\item telecommunication channel simulation
\item first-come-first-served job queuing
\end{itemize}

Additionally, multiple iterations of design and implementation are planned which may further enhance or extend the above functions.
Note, that the above list is not exhaustive.
A more detailed list is provided later in chapter \ref{chapter_4}.

\begin{figure}[H]
  \centering
  \begin{tikzpicture}[node distance=1cm,auto]
    \tikzset{
      circlenode/.style={circle,draw=black,very thick,inner sep=0em,minimum size=2cm,text width=2cm,text centered},
      rectroundnode/.style={rectangle,rounded corners,draw=black,very thick,inner sep=0.5em,minimum size=2em,text width=2cm,text centered},
      rectnode/.style={rectangle,draw=black,very thick,inner sep=0.5em,minimum size=2em,text width=2cm,text centered},
      arrowlabel/.style={text width=7em,text centered},
      arrow/.style={->,>=latex',shorten >=1pt,thick}
    }
    \node[rectroundnode](user){User};
    \node[rectnode,right=3cm of user](queue){Job queuing};
    \node[circlenode,below=of queue](initialization){Hardware initialization};
    \node[circlenode,below=of initialization](job){Scenario execution};
    \node[rectnode,below=of job](results){Experiment results};

    \draw[arrow](user.east) -- node[arrowlabel,above]{\small configuration and input data} (queue.west);
    \draw[arrow](queue.south) -- (initialization.north);
    \draw[arrow](initialization.south) -- (job.north);
    \draw[arrow](job.south) -- (results.north);
    \draw[arrow](results.west) -| node[arrowlabel,below]{\small output data} (user.south);
  \end{tikzpicture}
  \medskip
  \caption{Basic experiment flow}
  \label{basic flow}
\end{figure}

Figure \ref{basic flow} shows the very basic experiment flow, based on the high-level functions.
The user submits the SDR Testbed configuration as well as experiment input data.
A job queuing mechanism queues the job for the user.
Once the job is picked up, the hardware is initialized, based on the configuration parameters.
The experiment scenario is executed using the input data provided.
As a final step, the result of the experiment is output and becomes available to the user.

\section{System Perspective}

\begin{figure}[H]
  \centering
  \begin{tikzpicture}[node distance=1cm,auto]
    \tikzset{
      rectroundnode/.style={rectangle,rounded corners,draw=black,very thick,inner sep=0.5em,minimum height=3em,text width=2.5cm,text centered},
      arrowlabel/.style={text width=7em},
      arrow/.style={<->,>=latex',shorten >=1pt,thick}
    }
    \node[rectroundnode,minimum width=15em](host){Computer host};
    \node[rectroundnode,below=of host,minimum width=15em](hub){USB/Ethernet hub};
    \node[rectroundnode,below=of hub,text width=1cm](sdr2){SDR \#2};
    \node[rectroundnode,left=0.5cm of sdr2,text width=1cm](sdr1){SDR \#1};
    \node[rectroundnode,right=0.5cm of sdr2,text width=1cm](sdrn){SDR \#N};
    \node[rectroundnode,below=of sdr2,minimum width=15em](progswitch){Programmable switch};
    \node[rectroundnode,below=of progswitch,minimum width=15em](progatt){Programmable attenuator};

    \draw[arrow](host.south) -- node[arrowlabel,right]{\small control \& data} (hub.north);
    \draw[arrow](hub.south) -- node[arrowlabel,right]{\rotatebox{90}{\small data}} (sdr2.north);
    \draw[arrow](hub.south -| sdr1.north) -- node[arrowlabel,right]{\rotatebox{90}{\small data}} (sdr1.north);
    \draw[arrow](hub.south -| sdrn.north) -- node[arrowlabel,right]{\rotatebox{90}{\small data}} (sdrn.north);
    \draw[arrow](sdr2.south) -- node[arrowlabel,right]{\rotatebox{90}{\small RF}} (progswitch.north);
    \draw[arrow](sdr1.south) -- node[arrowlabel,right]{\rotatebox{90}{\small RF}} (progswitch.north -| sdr1.south);
    \draw[arrow](sdrn.south) -- node[arrowlabel,right]{\rotatebox{90}{\small RF}} (progswitch.north -| sdrn.south);
    \draw[arrow](progswitch.south) -- node[arrowlabel,right]{\rotatebox{90}{\small RF}} (progatt.north);
    \draw[arrow,<-](progswitch.west) -| ++(-1cm,0) node[arrowlabel,below,text centered]{\small control} |- (hub.west);
    \draw[arrow,<-](progatt.east) -| ++(1cm,0) node[arrowlabel,below,text centered]{\small control} |- (hub.east);

  \end{tikzpicture}
  \medskip
  \caption{Example hardware block diagram}
  \label{hardware block diagram}
\end{figure}

The SDR Testbed consists both of software and hardware components.
Figure \ref{hardware block diagram} shows an example high-level block diagram of the hardware components.
These components are:
\begin{itemize}
\item A computer host on which the SDR Testbed software will be running
\item A USB or/and Ethernet hub for the SDR devices and programmable RF components to connect with the host
\item A set of SDR devices
\item A set of programmable RF componets (e.g. RF switch, attenuators, etc.)
\item A set of fixed components (e.g. USB, Ethernet, RF cables and connectors, fixed attenuators, etc.)
\end{itemize}

\noindent
\begin{figure}[H]
  \centering
  \begin{tikzpicture}[node distance=1cm,auto]
    \tikzset{
      rectroundnode/.style={rectangle,rounded corners,draw=black,very thick,inner sep=0.5em,minimum height=3em,text width=2.5cm,text centered},
      rectfit/.style={rounded corners,draw=black,very thick,inner sep=0.5em,minimum height=3em,text width=2.5cm,text centered},
      arrowlabel/.style={text width=7em},
      arrow/.style={<->,>=latex',shorten >=1pt,thick}
    }
    \node[rectroundnode,minimum width=10em](userinterface){User interfaces};
    \node[rectroundnode,right=3.5em of userinterface,minimum width=10em](jobserver){Job queuing service};
    \node[rectroundnode,below=of jobserver,minimum width=7em](automation){Automation framework};
    \node[rectroundnode,below=of automation,minimum width=7em](wrapper){SDR control interface wrapper};
    \node[rectroundnode,right=of automation,minimum width=7em](testbedconfig){SDR testbed configuration software};
    \node[rectroundnode,right=of wrapper,minimum width=7em](sdrplatform){SDR development platform};
    \node[rectroundnode,minimum width=10em,minimum height=8em,below=of userinterface](storage){Experiment results storage service};
    \node[rectfit,fit=(automation)(testbedconfig)(wrapper),dashed,label={below left:container}](container){};

    \draw[arrow,->](userinterface.east) -- node[arrowlabel,above,text centered]{\small scenario \\ \& data} (jobserver.west);
    \draw[arrow,->](jobserver.south) -- node[arrowlabel,right]{\small job} (automation.north);
    \draw[arrow,->](automation.east) -- node[arrowlabel,above,text centered]{\small config} (testbedconfig.west);
    \draw[arrow](automation.south) -- node[arrowlabel,right]{\small control \\ \& data} (wrapper.north);
    \draw[arrow](wrapper.east) -- node[arrowlabel,above,text centered]{\small control \\ \& data} (sdrplatform.west);
    \draw[arrow,<-](userinterface.south) -- node[arrowlabel,right]{\small experiment results} (storage.north);
    \draw[arrow,->](automation.west) -- node[arrowlabel,above,text centered]{\small data} (storage.east |- automation.west);

  \end{tikzpicture}
  \medskip
  \caption{Example software block diagram}
  \label{software block diagram}
\end{figure}

Figure \ref{software block diagram} shows an example high-level block diagram of the software components.
These components are:
\begin{itemize}
\item Interfaces which the user will use to submit scenarios and data and retrieve experiment results
\item A job queuing service
\item A container in which application will be running
\item An automation framework which will execute the scenario submitted by the user
\item Software to configure the SDR testbed
\item Software to act as an wrapper for controlling the SDR development platform
\item An SDR development platform which the SDR application will run on
\item A storage service where the experiment results will be stored
\end{itemize}

As a whole, the SDR Testbed shall be an independent and totally self-contained system and not part of a larger system.
Thus, no strict requirements for external interfaces are set.
Nevertheless, additional ready-made components not defined in this specification may be used to complete it.

\section{Operating Environment}

The software operating environment will be based, to the maximum extent possible, on free and open source software.
All software components of SDR Testbed will be running on Linux OS.
It is suggested that a modern enterprise grade Linux distribution (e.g. CentOS) should be used for this purpose.
The services and application will be containerized to provide isolation and easier management.

The hardware operating environment can be based both on commercial and/or non-commercial hardware.
The testbed will be developed for x86-64 hardware platform, either server or COTS PC.
Nevertheless, provision has been made so that it will be possible to run on different architectures with minimal changes.
Most of the communication between hardware components will be over USB or IP network.

\section{Design and Implementation Constraints}

The following design and implementation constraints will be present on the SDR Testbed:
\begin{itemize}
\item Jobs will be queued and executed sequentially.
  The testbed can only handle a single experiment at a time.
  Nevertheless, scaling-out will be possible i.e. by adding more SDR Testbeds.
\item A limited number of SDR devices will be supported.
  Hardware restrictions place a limit on the number of devices which can be supported.
  A fixed number of USB and Ethernet ports will be available on the system for connecting SDR devices.
\item The duration of an experiment will be limited.
  Since the jobs will be executed sequentially, a limit on the duration of experiments will be placed.
\end{itemize}

\section{Documentation}

The documentation will consist of two parts:
\begin{itemize}
\item Users' documentation.
  This documentation will be the manual on how to use the testbed from users' point of view.
\item Developers' documentation.
  This documentation will be intended for developers on how to further extend or maintain the system.
\end{itemize}

\section{Assumption and Dependencies}

This system will be designed with the assumption that any experiment will not exceed the performance limits of the hardware.
This includes CPU power, RAM available, storage space, etc. as well as electrical characteristics (e.g. PSU or USB power available).
See chapter \ref{chapter_4} for more details.


\chapter{External Interfaces}
\section{User Interfaces}

The entry point of the user to the SDR Testbed shall be a Git repository.
The user shall commit:
\begin{itemize}
\item the scenario for an experiment.
  This scenario shall be written as a Robot Framework Suite.
\item raw data to be fed to the SDR devices.
  Git LFS shall be used to commit raw I/Q data.
\item configuration of the SDR Testbed hardware.
  The configuration includes selection of the SDR devices to be used and attenuation level.
\end{itemize}
The user shall push the commits to a remote Git repository managed by GitLab.
GitLab CI shall queue a job to be executed to the computer host where the SDR devices are attached.
After the execution and completion of the job, the host shall upload the results to the server managing the jobs.
The user shall be able to view and download the results of the experiment from the job server.

\section{Software Interfaces}

The SDR Testbed shall have the following software interfaces:
\begin{itemize}
\item an SDR development platform.
  GNU Radio shall be the platform which will be supported initially.
  Nevertheless, it shall be possible to support other platforms in the future (i.e. Pothos SDR).
\item VISA API and instrument drivers.
  VISA is a standard instrument control abstraction layer and shall be used to control the programmable RF switches and attenuators.
\item an SDR control and data interface.
  A new software interface shall be developed to abstract the control and data exchange towards the SDR application.
  This interface shall act as a wrapper function with a purpose to allow realtime control of the SDR during an experiment.
\item an experiment results file format interface.
  HDF5 file format shall be used to store the some experiment results.
  This interface is the library for supporting HDF5 storing.
\end{itemize}

\section{Hardware Interfaces}

The SDR Testbed shall have the following hardware interfaces:
\begin{itemize}
\item USB interfaces for connecting SDR devices.
\item Ethernet interfaces for connecting SDR devices and programmable RF switches and attenuators.
\item RF interfaces for connecting SDR devices with programmable switches and attenuators.
\end{itemize}

\section{Communication Interfaces}

The SDR Testbed shall have the following communication interfaces:
\begin{itemize}
\item SCPI.
  This interface shall be used to control the programmable RF switch and attenuators.
\item SDR control and data sockets.
  Separate network or Unix domain sockets shall be used for controlling and exchanging data with the SDR development platform.
  These communication interface shall provide support for realtime control of the SDR application.
\end{itemize}

\chapter{Requirements} \label{chapter_4}
\section{Functional Requirements}

\requirement{REQ.0001}{Availability of computer host USB ports}{
  The computer host shall have at least 4 USB3.x and 2 x USB2.x ports.
}{
  Most of the SDR devices interface via USB.
  The computer host should have enough USB ports to accommodate all available SDR devices.
}{}
\requirement{REQ.0002}{Availability of computer host Ethernet}{
  The computer host shall have at least one 1000BASE‑T Ethernet port.
}{
  Some SDR devices interface via Ethernet.
  In addition, programmable RF switches and attenuators interface via Ethernet, too.
  The computer host should have at least one Ethernet port capable of transferring data with high enough throughput to support these devices.
}{}
\requirement{REQ.0003}{Network connectivity for multiple devices}{
  An 8-port managed 1000BASE-T Ethernet switch shall be used to provide network connectivity with devices.
}{
  A network switch is required to connect all the devices communication via Ethernet.
  The switch shall be manageable for easy configuration, monitoring and adaptation on existing networking infrastructures.
}{}
\requirement{REQ.0004}{Support for PlutoSDR SDR device}{
  The SDR testbed shall support Pluto SDR SDR device
}{
  PlutoSDR is one of the selected SDR devices to be supported, based on the requirements survey.
}{}
\requirement{REQ.0005}{Support for Airspy Mini SDR device}{
  The SDR testbed shall support Airspy Mini SDR device
}{
  Airspy Mini is one of the selected SDR devices to be supported, based on the requirements survey.
}{}
\requirement{REQ.0006}{Support for SDRPlay RSPduo SDR device}{
  The SDR testbed shall support SDRPlay RSPduo SDR device
}{
  SDRPlay RSPduo is one of the selected SDR devices to be supported, based on the requirements survey.
}{}
\requirement{REQ.0007}{Support for LimeSDR Mini SDR device}{
  The SDR testbed shall support LimeSDR Mini SDR device
}{
  LimeSDR Mini is one of the selected SDR devices to be supported, based on the requirements survey.
}{}
\requirement{REQ.0008}{Support for bladeRF 2.0 micro SDR device}{
  The SDR testbed shall support bladeRF 2.0 micro SDR device
}{
  bladeRF 2.0 micro is one of the selected SDR devices to be supported, based on the requirements survey.
}{}
\requirement{REQ.0009}{Support for USRP B210 SDR device}{
  The SDR testbed shall support USRP B210 SDR device
}{
  USRP B210 is one of the selected SDR devices to be supported, based on the requirements survey.
}{}
\requirement{REQ.0010}{Support for RTL-SDR v3 SDR device}{
  The SDR testbed shall support RTL-SDR v3 SDR device
}{
  RTL-SDR v3 is one of the selected SDR devices to be supported, based on the requirements survey.
}{}
\requirement{REQ.0011}{Support for programmable selection of SDR devices}{
  A pair of programmable SP4T RF switches shall be used to switch RF connections between SDR devices.
  The RF switch characteristics are:
  \begin{itemize}
  \item isolation: >=60dB
  \item reliability: >=10Mcycles
  \item insertion loss: <=1dB
  \end{itemize}
  A candidate RF switch is the RC-2SP4T-A18 from Mini-Circuits.
  %%Figure XXX shows a connection diagram between the programmable RF switch and the SDR devices
  A single pair of SDR devices shall be connected at any time.
  A total of 16 combinations of SDR devices shall be supported.
}{
  For each experiment a pair of SDR devices will be selected.
  These devices should be RF connected programmably.
  A pair of SP4T RF switches shall be used to provide such connectivity.
}{}
\requirement{REQ.0012}{Support for programmable selection of attenuation levels}{
  The attenuation levels between the pair of SDR devices shall be controlled programmably.
  A single programmable RF attenuator shall be used for this purpose.
  The RF attenuator characteristics are:
  \begin{itemize}
  \item range: 0dB to -60dB
  \item resolution: 0.25dB
  \item power rating: 20dBm
  \item Ethernet control
  \end{itemize}
  A candidate device is the RCDAT-6000-60 from Mini-Circuits.
  %%Figure XXX shows a connection diagram between the programmable RF switch and the SDR devices
}{
  An experiment can require variable attenuation conditions.
  The testbed shall accommodate such cases by using a programmable attenuator.
}{}
\requirement{REQ.0013}{Fixed attenuation between selected SDR devices}{
  There shall be a fixed RF attenuation between the selected SDR devices for an experiment.
  This attenuation shall be -60dBm.
  Some candidate devices are the BW-S30W2+ or BW-S20W2+ from Mini-Circuits.
}{
  A fixed attenuation is required to emulate free-space path loss conditions.
  Combined with the programmable attenuator, this shall give an attenuation range of -60db - -120dB.
}{}

\section{Performance Requirements}

\requirement{REQ.0101}{Dimensions of computer host RAM}{
  The computer host shall have at least 16GiB of available RAM
}{
  Some SDR applications are very demanding to RAM.
  The computer host RAM capacity should be high enough to accommodate such applications.
}{}
\requirement{REQ.0102}{Dimensions of computer host multi-threading}{
  The computer host shall support at least 8 parallel CPU threads
}{
  The testbed should support SDR applications which require multiple CPU threads.
}{}
\requirement{REQ.0103}{Dimensions of computer host storage}{
  The computer host shall have at least 200GiB of SSD storage available.
}{
  An experiment may produce large amounts of data while also requiring fast file write access.
  The testbed should support such a case.
}{}

\section{Security Requirements}


\chapter*{Appendix I: Glossary and Acronyms}
\addcontentsline{toc}{chapter}{Appendix I: Glossary and Acronyms}

\printglossary
\printglossary[type=\acronymtype]

\end{document}
